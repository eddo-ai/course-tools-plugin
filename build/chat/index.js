(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,r=window.wp.components,n=window.wp.data,o=window.wp.preferences,s=window.ReactJSXRuntime,a=JSON.parse('{"apiVersion":2,"name":"eddolearning/chat","title":"Eddo Learning Assistant Chat","category":"common","icon":"format-chat","description":"Embed a chat interface","attributes":{"chatSrc":{"type":"string","default":"https://chat.livelyplant-e406dec0.eastus.azurecontainerapps.io"},"unitId":{"type":"string","default":"7.1"}},"supports":{"html":false},"textdomain":"eddolearning","editorScript":"file:./index.js","dependencies":["wp-blocks","wp-block-editor","wp-components","wp-data","wp-core-data"]}');(0,e.registerBlockType)(a.name,{...a,edit:function({attributes:e,setAttributes:a,isSelected:i}){const c=(0,t.useBlockProps)(),{chatSrc:l,unitId:d}=e,u=(0,n.useSelect)((e=>e(o.store).get("eddolearning-course-tools","defaultChatUrl")),[]),{set:h}=(0,n.useDispatch)(o.store),p=u||"https://chat.livelyplant-e406dec0.eastus.azurecontainerapps.io",g=(0,n.useSelect)((e=>{const{getEditedPostAttribute:t}=e("core/editor");return t("title")||""}),[]);console.log("Current post title:",g),l||a({chatSrc:p});const w=(e=>{try{const t=new URL(e||p);return g&&t.searchParams.set("lesson_name",encodeURIComponent(g)),d&&t.searchParams.set("unit_id",encodeURIComponent(d)),t.searchParams.set("embed","true"),t.toString()}catch(e){return console.error("Error constructing URL:",e),`${p}?embed=true`}})(l);return console.log("Final iframe URL:",w),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.InspectorControls,{children:(0,s.jsxs)(r.PanelBody,{title:"Chat Settings",initialOpen:!0,children:[(0,s.jsx)(r.TextControl,{label:"Chat URL",value:l,onChange:e=>{a({chatSrc:e});try{new URL(e),h("eddolearning-course-tools","defaultChatUrl",e)}catch(t){console.warn("Invalid URL not saved as default:",e)}},help:"The base URL for the chat interface"}),(0,s.jsx)(r.TextControl,{label:"Unit ID",value:d,onChange:e=>a({unitId:e}),help:"The unit ID for this lesson (e.g. 7.1)"})]})}),(0,s.jsx)("div",{...c,children:l&&(0,s.jsxs)("div",{className:"wp-block-eddolearning-chat-wrapper",style:{position:"relative"},children:[(0,s.jsx)("iframe",{src:w,height:"600",style:{width:"100%",border:"none"},title:"Chat Interface"}),!i&&(0,s.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,cursor:"pointer",background:"rgba(0, 0, 0, 0.02)",transition:"background 0.2s ease"},onMouseOver:e=>{e.currentTarget.style.background="rgba(0, 0, 0, 0.05)"},onMouseOut:e=>{e.currentTarget.style.background="rgba(0, 0, 0, 0.02)"},"aria-label":"Select chat block"})]})})]})},save:function({attributes:e}){const{chatSrc:r,unitId:n}=e,o=t.useBlockProps.save();return(0,s.jsx)("div",{...o,children:r&&(0,s.jsx)("div",{className:"wp-block-eddolearning-chat-wrapper",style:{position:"relative",width:"100%",height:"600px"},children:(0,s.jsx)("iframe",{src:(e=>{try{const t=new URL(e);return t.searchParams.set("unit_id",encodeURIComponent(n)),t.searchParams.set("embed","true"),t.toString()}catch(t){return e}})(r),style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"},title:"Chat Interface"})})})}})})();